var et=(t,e,n)=>new Promise((a,r)=>{var s=i=>{try{o(n.next(i))}catch(u){r(u)}},l=i=>{try{o(n.throw(i))}catch(u){r(u)}},o=i=>i.done?a(i.value):Promise.resolve(i.value).then(s,l);o((n=n.apply(t,e)).next())});import{e as q,b as Fn,f as Rn,E as W,g as Lt,h as Mn,i as zt}from"./request.1b18911b.js";import{r as F,c as I,ar as fn,M as Me,w as Fe,d as Dn,W as ve,o as zn,ah as yt,U as On,V as Bn,p as _,a as j,b as _n,e as In,f as K,Q as tt,R as nt,j as at,i as rt,k as ye,T as $n,as as jn,u as re,S as Un,at as Vn,Z as qe,a4 as Nn,a8 as Kn,$ as Tt,au as Wn,a7 as de}from"./index.544cacf2.js";import{c as V}from"./common.2468cf2c.js";import{u as qn}from"./useCommon.b74cc26c.js";import{E as oe}from"./index.e933e8df.js";import{E as bt}from"./index.22b79fd0.js";const ee=F([]);let Oe=null;function Qe(t){t&&(Oe=t);const e=()=>{Oe.proxy.$refs.fileTableRef.clearSelection()},n=(d,v)=>{(d==null?void 0:d.type)!=="BACK"&&Oe.proxy.$refs.fileTableRef.toggleRowSelection(d,v)},a=()=>{Oe.proxy.$refs.fileTableRef.toggleAllSelection()},r=d=>d.type==="FILE"||d.type==="FOLDER",s=I(()=>ee.value.length>0?ee.value[ee.value.length-1]:null),l=I(()=>ee.value.filter(d=>d.type==="FILE")),o=I(()=>ee.value.filter(d=>d.type==="FOLDER")),i=d=>{ee.value=d},u=({row:d,rowIndex:v})=>(d.index=v,ee.value.indexOf(d)!==-1?"select-row":""),g=I(()=>{let d=ee.value.length,v=l.value.length,f=o.value.length,h=d===1,x=d>1;return{isSingleSelect:h,isMultiSelect:x,isAllFile:v===d,isAllFolder:f===d}});return{checkSelectable:r,tableRowClassName:u,selectRowsChange:i,selectRow:s,selectRows:ee,selectFiles:l,selectFolders:o,selectStatistics:g,clearSelection:e,toggleRowSelection:n,toggleAllSelection:a}}let{selectStatistics:ie}=Qe();const De=fn("storageConfigStore",{state:()=>({globalConfig:{siteName:"",directLinkPrefix:"",infoEnable:!1,showLinkBtn:!1,recordDownloadLog:!1,showShortLink:!1,showPathLink:!1,tableSize:"small",rootShowStorage:!0,fileClickMode:"dbclick",showDocument:!1,debugMode:!1,domain:"",icp:"",avatar:"",announcement:"",layout:"full",showAnnouncement:!1,searchEnable:!1,showLogin:!1},folderConfig:{readmeText:null,readmeDisplayMode:null,defaultSwitchToImgMode:!1,enableFileOperator:!1}}),getters:{permission:t=>({open:ie.value.isSingleSelect&&ie.value.isAllFolder,preview:ie.value.isAllFile&&ie.value.isSingleSelect,download:ie.value.isAllFile,link:ie.value.isAllFile&&t.globalConfig.showLinkBtn&&(t.globalConfig.showShortLink||t.globalConfig.showPathLink),rename:t.folderConfig.enableFileOperator&&ie.value.isSingleSelect,delete:t.folderConfig.enableFileOperator,newFolder:t.folderConfig.enableFileOperator,upload:t.folderConfig.enableFileOperator,pathLink:t.globalConfig.showPathLink,shortLink:t.globalConfig.showShortLink})},actions:{updateGlobalConfig(t){this.globalConfig=t},updateFolderConfig(t){this.folderConfig=t}}}),Or=t=>q({url:"/api/site/reset-password",method:"get",data:t}),Hn=t=>q({url:"/api/storage/list",method:"get",data:t}),me=fn("fileDataStore",{state:()=>({currentClickRow:{},currentRightClickRow:{},currentStorageSource:{id:null,type:{description:"",key:""}},imgMode:!1,newImgMode:!1,oldStorageKey:null,searchParam:"",fileListSource:[],audioArray:[],audioIndex:0}),getters:{filterFileByType:t=>e=>t.fileListSource.filter(function(n){if(n.type==="BACK")return!1;let a=n.name,r=a.substr(a.lastIndexOf(".")+1).toLowerCase();return V.constant.fileTypeMap[e].indexOf(r)!==-1}),fileList:t=>{let e=t.fileListSource;return e.forEach(n=>{if(n.icon||(n.icon=V.getFileIconName(n)),n.preview!==null){var a=V.getFileType(n.name);a?(n.fileType=a,n.preview=V.constant.previewFileType.indexOf(a)!==-1):n.preview=!1}}),e}},actions:{updateCurrentStorageSource(t){this.currentStorageSource=t},updateAudioIndex(t){this.audioIndex=t},updateAudioList(t){this.audioArray=t},updateCurrentClickRow(t){this.currentClickRow=t},updateCurrentRightClickRow(t){this.currentRightClickRow=t},updateFileList(t){this.fileListSource=t},updateOldStorageKey(t){this.oldStorageKey=t}}});let Ot=me(),Bt=De(),{routerRef:lt,fullpath:Gn,storageKey:Be}=Me(),ne=F([]),be=F(),_t=!1;function Yn(){let t=Bt.globalConfig.rootShowStorage,e=()=>new Promise(o=>{Hn().then(i=>{if(ne.value=i.data,ne.value.length===0){oe.confirm("\u5F53\u524D\u65E0\u53EF\u7528\u5B58\u50A8\u6E90\uFF0C\u662F\u5426\u8DF3\u8F6C\u81F3\u7BA1\u7406\u5458\u9875\u9762\u6DFB\u52A0\u5B58\u50A8\u6E90\uFF1F","\u63D0\u793A",{confirmButtonText:"\u786E\u5B9A",cancelButtonText:"\u53D6\u6D88",type:"info",callback:u=>{u==="confirm"&&lt.value.push("/login")}});return}n(t),o(i)})});const n=o=>{Be.value?l(Be.value)?be.value=Be.value:s():o?(Ot.updateFileList(a.value),document.title=Bt.globalConfig.siteName+" | \u9996\u9875"):s(),r()},a=I(()=>{let o=[];return ne.value.forEach(i=>{o.push({name:i.name,path:i.key,size:0,time:"-",type:"ROOT"})}),o}),r=()=>{ne.value.some(o=>{o.key===be.value&&Ot.updateCurrentStorageSource(o)})};_t||(Fe(()=>be.value,(o,i)=>{(o&&!Gn.value||i!==void 0)&&(lt.value.push("/"+o),r())}),Fe(()=>Be.value,o=>{n(!0)}),_t=!0);const s=()=>{if(ne.value.length>0){let o=ne.value[0].key;be.value=o,lt.value.push("/"+o)}},l=o=>ne.value.find(i=>{if(i.key==o)return i});return{loadStorageSourceList:e,storageList:ne,findStorageByKey:l,currentStorageKey:be,storageListAsFileList:a}}var Re={};Object.defineProperty(Re,"__esModule",{value:!0});var He=Re.removeDuplicateSlashes=Re.transform=void 0;const Qn=/(?!^)\/{2,}/g;function Xn(t){return t.map(e=>gn(e))}Re.transform=Xn;function gn(t){return t.replace(Qn,"/")}He=Re.removeDuplicateSlashes=gn;const Zn=typeof process=="object"&&process&&process.platform==="win32";var Jn=Zn?{sep:"\\"}:{sep:"/"},ea=pn;function pn(t,e,n){t instanceof RegExp&&(t=It(t,n)),e instanceof RegExp&&(e=It(e,n));var a=hn(t,e,n);return a&&{start:a[0],end:a[1],pre:n.slice(0,a[0]),body:n.slice(a[0]+t.length,a[1]),post:n.slice(a[1]+e.length)}}function It(t,e){var n=e.match(t);return n?n[0]:null}pn.range=hn;function hn(t,e,n){var a,r,s,l,o,i=n.indexOf(t),u=n.indexOf(e,i+1),g=i;if(i>=0&&u>0){if(t===e)return[i,u];for(a=[],s=n.length;g>=0&&!o;)g==i?(a.push(g),i=n.indexOf(t,g+1)):a.length==1?o=[a.pop(),u]:(r=a.pop(),r<s&&(s=r,l=u),u=n.indexOf(e,g+1)),g=i<u&&i>=0?i:u;a.length&&(o=[s,l])}return o}var vn=ea,ta=ra,mn="\0SLASH"+Math.random()+"\0",yn="\0OPEN"+Math.random()+"\0",Pt="\0CLOSE"+Math.random()+"\0",bn="\0COMMA"+Math.random()+"\0",wn="\0PERIOD"+Math.random()+"\0";function ot(t){return parseInt(t,10)==t?parseInt(t,10):t.charCodeAt(0)}function na(t){return t.split("\\\\").join(mn).split("\\{").join(yn).split("\\}").join(Pt).split("\\,").join(bn).split("\\.").join(wn)}function aa(t){return t.split(mn).join("\\").split(yn).join("{").split(Pt).join("}").split(bn).join(",").split(wn).join(".")}function Sn(t){if(!t)return[""];var e=[],n=vn("{","}",t);if(!n)return t.split(",");var a=n.pre,r=n.body,s=n.post,l=a.split(",");l[l.length-1]+="{"+r+"}";var o=Sn(s);return s.length&&(l[l.length-1]+=o.shift(),l.push.apply(l,o)),e.push.apply(e,l),e}function ra(t){return t?(t.substr(0,2)==="{}"&&(t="\\{\\}"+t.substr(2)),Le(na(t),!0).map(aa)):[]}function la(t){return"{"+t+"}"}function oa(t){return/^-?0\d/.test(t)}function ia(t,e){return t<=e}function sa(t,e){return t>=e}function Le(t,e){var n=[],a=vn("{","}",t);if(!a)return[t];var r=a.pre,s=a.post.length?Le(a.post,!1):[""];if(/\$$/.test(a.pre))for(var l=0;l<s.length;l++){var o=r+"{"+a.body+"}"+s[l];n.push(o)}else{var i=/^-?\d+\.\.-?\d+(?:\.\.-?\d+)?$/.test(a.body),u=/^[a-zA-Z]\.\.[a-zA-Z](?:\.\.-?\d+)?$/.test(a.body),g=i||u,d=a.body.indexOf(",")>=0;if(!g&&!d)return a.post.match(/,.*\}/)?(t=a.pre+"{"+a.body+Pt+a.post,Le(t)):[t];var v;if(g)v=a.body.split(/\.\./);else if(v=Sn(a.body),v.length===1&&(v=Le(v[0],!1).map(la),v.length===1))return s.map(function(k){return a.pre+v[0]+k});var f;if(g){var h=ot(v[0]),x=ot(v[1]),M=Math.max(v[0].length,v[1].length),P=v.length==3?Math.abs(ot(v[2])):1,D=ia,S=x<h;S&&(P*=-1,D=sa);var w=v.some(oa);f=[];for(var c=h;D(c,x);c+=P){var m;if(u)m=String.fromCharCode(c),m==="\\"&&(m="");else if(m=String(c),w){var p=M-m.length;if(p>0){var y=new Array(p+1).join("0");c<0?m="-"+y+m.slice(1):m=y+m}}f.push(m)}}else{f=[];for(var C=0;C<v.length;C++)f.push.apply(f,Le(v[C],!1))}for(var C=0;C<f.length;C++)for(var l=0;l<s.length;l++){var o=r+f[C]+s[l];(!e||g||o)&&n.push(o)}}return n}const N=Cn=(t,e,n={})=>(Ge(e),!n.nocomment&&e.charAt(0)==="#"?!1:new Xe(e,n).match(t));var Cn=N;const wt=Jn;N.sep=wt.sep;const G=Symbol("globstar **");N.GLOBSTAR=G;const ua=ta,$t={"!":{open:"(?:(?!(?:",close:"))[^/]*?)"},"?":{open:"(?:",close:")?"},"+":{open:"(?:",close:")+"},"*":{open:"(?:",close:")*"},"@":{open:"(?:",close:")"}},St="[^/]",it=St+"*?",ca="(?:(?!(?:\\/|^)(?:\\.{1,2})($|\\/)).)*?",da="(?:(?!(?:\\/|^)\\.).)*?",xn=t=>t.split("").reduce((e,n)=>(e[n]=!0,e),{}),jt=xn("().*{}+?[]^$\\!"),fa=xn("[.("),Ut=/\/+/;N.filter=(t,e={})=>(n,a,r)=>N(n,t,e);const ae=(t,e={})=>{const n={};return Object.keys(t).forEach(a=>n[a]=t[a]),Object.keys(e).forEach(a=>n[a]=e[a]),n};N.defaults=t=>{if(!t||typeof t!="object"||!Object.keys(t).length)return N;const e=N,n=(a,r,s)=>e(a,r,ae(t,s));return n.Minimatch=class extends e.Minimatch{constructor(r,s){super(r,ae(t,s))}},n.Minimatch.defaults=a=>e.defaults(ae(t,a)).Minimatch,n.filter=(a,r)=>e.filter(a,ae(t,r)),n.defaults=a=>e.defaults(ae(t,a)),n.makeRe=(a,r)=>e.makeRe(a,ae(t,r)),n.braceExpand=(a,r)=>e.braceExpand(a,ae(t,r)),n.match=(a,r,s)=>e.match(a,r,ae(t,s)),n};N.braceExpand=(t,e)=>kn(t,e);const kn=(t,e={})=>(Ge(t),e.nobrace||!/\{(?:(?!\{).)*\}/.test(t)?[t]:ua(t)),ga=1024*64,Ge=t=>{if(typeof t!="string")throw new TypeError("invalid pattern");if(t.length>ga)throw new TypeError("pattern is too long")},_e=Symbol("subparse");N.makeRe=(t,e)=>new Xe(t,e||{}).makeRe();N.match=(t,e,n={})=>{const a=new Xe(e,n);return t=t.filter(r=>a.match(r)),a.options.nonull&&!t.length&&t.push(e),t};const pa=t=>t.replace(/\\(.)/g,"$1"),ha=t=>t.replace(/[-[\]{}()*+?.,\\^$|#\s]/g,"\\$&");class Xe{constructor(e,n){Ge(e),n||(n={}),this.options=n,this.set=[],this.pattern=e,this.windowsPathsNoEscape=!!n.windowsPathsNoEscape||n.allowWindowsEscape===!1,this.windowsPathsNoEscape&&(this.pattern=this.pattern.replace(/\\/g,"/")),this.regexp=null,this.negate=!1,this.comment=!1,this.empty=!1,this.partial=!!n.partial,this.make()}debug(){}make(){const e=this.pattern,n=this.options;if(!n.nocomment&&e.charAt(0)==="#"){this.comment=!0;return}if(!e){this.empty=!0;return}this.parseNegate();let a=this.globSet=this.braceExpand();n.debug&&(this.debug=(...r)=>console.error(...r)),this.debug(this.pattern,a),a=this.globParts=a.map(r=>r.split(Ut)),this.debug(this.pattern,a),a=a.map((r,s,l)=>r.map(this.parse,this)),this.debug(this.pattern,a),a=a.filter(r=>r.indexOf(!1)===-1),this.debug(this.pattern,a),this.set=a}parseNegate(){if(this.options.nonegate)return;const e=this.pattern;let n=!1,a=0;for(let r=0;r<e.length&&e.charAt(r)==="!";r++)n=!n,a++;a&&(this.pattern=e.substr(a)),this.negate=n}matchOne(e,n,a){var r=this.options;this.debug("matchOne",{this:this,file:e,pattern:n}),this.debug("matchOne",e.length,n.length);for(var s=0,l=0,o=e.length,i=n.length;s<o&&l<i;s++,l++){this.debug("matchOne loop");var u=n[l],g=e[s];if(this.debug(n,u,g),u===!1)return!1;if(u===G){this.debug("GLOBSTAR",[n,u,g]);var d=s,v=l+1;if(v===i){for(this.debug("** at the end");s<o;s++)if(e[s]==="."||e[s]===".."||!r.dot&&e[s].charAt(0)===".")return!1;return!0}for(;d<o;){var f=e[d];if(this.debug(`
globstar while`,e,d,n,v,f),this.matchOne(e.slice(d),n.slice(v),a))return this.debug("globstar found match!",d,o,f),!0;if(f==="."||f===".."||!r.dot&&f.charAt(0)==="."){this.debug("dot detected!",e,d,n,v);break}this.debug("globstar swallow a segment, and continue"),d++}return!!(a&&(this.debug(`
>>> no match, partial?`,e,d,n,v),d===o))}var h;if(typeof u=="string"?(h=g===u,this.debug("string match",u,g,h)):(h=g.match(u),this.debug("pattern match",u,g,h)),!h)return!1}if(s===o&&l===i)return!0;if(s===o)return a;if(l===i)return s===o-1&&e[s]==="";throw new Error("wtf?")}braceExpand(){return kn(this.pattern,this.options)}parse(e,n){Ge(e);const a=this.options;if(e==="**")if(a.noglobstar)e="*";else return G;if(e==="")return"";let r="",s=!!a.nocase,l=!1;const o=[],i=[];let u,g=!1,d=-1,v=-1,f,h,x;const M=e.charAt(0)==="."?"":a.dot?"(?!(?:^|\\/)\\.{1,2}(?:$|\\/))":"(?!\\.)",P=()=>{if(u){switch(u){case"*":r+=it,s=!0;break;case"?":r+=St,s=!0;break;default:r+="\\"+u;break}this.debug("clearStateChar %j %j",u,r),u=!1}};for(let w=0,c;w<e.length&&(c=e.charAt(w));w++){if(this.debug("%s	%s %s %j",e,w,r,c),l){if(c==="/")return!1;jt[c]&&(r+="\\"),r+=c,l=!1;continue}switch(c){case"/":return!1;case"\\":P(),l=!0;continue;case"?":case"*":case"+":case"@":case"!":if(this.debug("%s	%s %s %j <-- stateChar",e,w,r,c),g){this.debug("  in class"),c==="!"&&w===v+1&&(c="^"),r+=c;continue}this.debug("call clearStateChar %j",u),P(),u=c,a.noext&&P();continue;case"(":if(g){r+="(";continue}if(!u){r+="\\(";continue}o.push({type:u,start:w-1,reStart:r.length,open:$t[u].open,close:$t[u].close}),r+=u==="!"?"(?:(?!(?:":"(?:",this.debug("plType %j %j",u,r),u=!1;continue;case")":if(g||!o.length){r+="\\)";continue}P(),s=!0,h=o.pop(),r+=h.close,h.type==="!"&&i.push(h),h.reEnd=r.length;continue;case"|":if(g||!o.length){r+="\\|";continue}P(),r+="|";continue;case"[":if(P(),g){r+="\\"+c;continue}g=!0,v=w,d=r.length,r+=c;continue;case"]":if(w===v+1||!g){r+="\\"+c;continue}f=e.substring(v+1,w);try{RegExp("["+f+"]")}catch(m){x=this.parse(f,_e),r=r.substr(0,d)+"\\["+x[0]+"\\]",s=s||x[1],g=!1;continue}s=!0,g=!1,r+=c;continue;default:P(),jt[c]&&!(c==="^"&&g)&&(r+="\\"),r+=c;break}}for(g&&(f=e.substr(v+1),x=this.parse(f,_e),r=r.substr(0,d)+"\\["+x[0],s=s||x[1]),h=o.pop();h;h=o.pop()){let w;w=r.slice(h.reStart+h.open.length),this.debug("setting tail",r,h),w=w.replace(/((?:\\{2}){0,64})(\\?)\|/g,(m,p,y)=>(y||(y="\\"),p+p+y+"|")),this.debug(`tail=%j
   %s`,w,w,h,r);const c=h.type==="*"?it:h.type==="?"?St:"\\"+h.type;s=!0,r=r.slice(0,h.reStart)+c+"\\("+w}P(),l&&(r+="\\\\");const D=fa[r.charAt(0)];for(let w=i.length-1;w>-1;w--){const c=i[w],m=r.slice(0,c.reStart),p=r.slice(c.reStart,c.reEnd-8);let y=r.slice(c.reEnd);const C=r.slice(c.reEnd-8,c.reEnd)+y,k=m.split("(").length-1;let R=y;for(let A=0;A<k;A++)R=R.replace(/\)[+*?]?/,"");y=R;const E=y===""&&n!==_e?"$":"";r=m+p+y+E+C}if(r!==""&&s&&(r="(?=.)"+r),D&&(r=M+r),n===_e)return[r,s];if(!s)return pa(e);const S=a.nocase?"i":"";try{return Object.assign(new RegExp("^"+r+"$",S),{_glob:e,_src:r})}catch(w){return new RegExp("$.")}}makeRe(){if(this.regexp||this.regexp===!1)return this.regexp;const e=this.set;if(!e.length)return this.regexp=!1,this.regexp;const n=this.options,a=n.noglobstar?it:n.dot?ca:da,r=n.nocase?"i":"";let s=e.map(l=>(l=l.map(o=>typeof o=="string"?ha(o):o===G?G:o._src).reduce((o,i)=>(o[o.length-1]===G&&i===G||o.push(i),o),[]),l.forEach((o,i)=>{o!==G||l[i-1]===G||(i===0?l.length>1?l[i+1]="(?:\\/|"+a+"\\/)?"+l[i+1]:l[i]=a:i===l.length-1?l[i-1]+="(?:\\/|"+a+")?":(l[i-1]+="(?:\\/|\\/"+a+"\\/)"+l[i+1],l[i+1]=G))}),l.filter(o=>o!==G).join("/"))).join("|");s="^(?:"+s+")$",this.negate&&(s="^(?!"+s+").*$");try{this.regexp=new RegExp(s,r)}catch(l){this.regexp=!1}return this.regexp}match(e,n=this.partial){if(this.debug("match",e,this.pattern),this.comment)return!1;if(this.empty)return e==="";if(e==="/"&&n)return!0;const a=this.options;wt.sep!=="/"&&(e=e.split(wt.sep).join("/")),e=e.split(Ut),this.debug(this.pattern,"split",e);const r=this.set;this.debug(this.pattern,"set",r);let s;for(let l=e.length-1;l>=0&&(s=e[l],!s);l--);for(let l=0;l<r.length;l++){const o=r[l];let i=e;if(a.matchBase&&o.length===1&&(i=[s]),this.matchOne(i,o,n))return a.flipNegate?!0:!this.negate}return a.flipNegate?!1:this.negate}static defaults(e){return N.defaults(e).Minimatch}}N.Minimatch=Xe;var va=Cn;let{storageKey:Ie,currentPath:ma}=Me();const fe=Fn("zfile-pwd-cache",{});function Et(){return{putPathPwd:(n,a)=>{n&&(n=n.startsWith("/")?n:"/"+n,fe.value[Ie.value]||(fe.value[Ie.value]={}),n.endsWith("**")&&!n.endsWith("/**")&&(n=He(n.substring(0,n.length-2)+"/**"),console.log("\u68C0\u6D4B\u5230\u5BC6\u7801\u6587\u4EF6\u5939\u901A\u914D\u7B26 ** \u524D\u672A\u5199 /\uFF0C\u81EA\u52A8\u5C06\u5176\u4FEE\u6B63\u4E3A\u4E3A\uFF1A",n)),fe.value[Ie.value][n]=a)},getPathPwd:n=>{let a=n||ma.value;a=V.removeDuplicateSeparator("/"+a+"/");for(let r of Object.keys(fe.value))if(r===Ie.value){for(let s of Object.keys(fe.value[r]))if(va(a,s))return fe.value[r][s]}return""}}}let{getPathPwd:Ze}=Et();const ya=t=>(t.password=Ze(t.path),q({url:"/api/file/operator/mkdir",method:"post",data:t})),ba=t=>q({url:"/api/file/operator/delete/batch",method:"post",data:t}),wa=t=>(t.password=Ze(t.path),q({url:"/api/file/operator/rename/file",method:"post",data:t})),Sa=t=>(t.password=Ze(t.path),q({url:"/api/file/operator/rename/folder",method:"post",data:t})),Ca=t=>(t.password=Ze(t.path),q({url:"/api/file/operator/upload/file",method:"post",data:t}));function Q(t){if(typeof t!="string")throw new TypeError("Path must be a string. Received "+JSON.stringify(t))}function Vt(t,e){for(var n="",a=0,r=-1,s=0,l,o=0;o<=t.length;++o){if(o<t.length)l=t.charCodeAt(o);else{if(l===47)break;l=47}if(l===47){if(!(r===o-1||s===1))if(r!==o-1&&s===2){if(n.length<2||a!==2||n.charCodeAt(n.length-1)!==46||n.charCodeAt(n.length-2)!==46){if(n.length>2){var i=n.lastIndexOf("/");if(i!==n.length-1){i===-1?(n="",a=0):(n=n.slice(0,i),a=n.length-1-n.lastIndexOf("/")),r=o,s=0;continue}}else if(n.length===2||n.length===1){n="",a=0,r=o,s=0;continue}}e&&(n.length>0?n+="/..":n="..",a=2)}else n.length>0?n+="/"+t.slice(r+1,o):n=t.slice(r+1,o),a=o-r-1;r=o,s=0}else l===46&&s!==-1?++s:s=-1}return n}function xa(t,e){var n=e.dir||e.root,a=e.base||(e.name||"")+(e.ext||"");return n?n===e.root?n+a:n+t+a:a}var he={resolve:function(){for(var e="",n=!1,a,r=arguments.length-1;r>=-1&&!n;r--){var s;r>=0?s=arguments[r]:(a===void 0&&(a=process.cwd()),s=a),Q(s),s.length!==0&&(e=s+"/"+e,n=s.charCodeAt(0)===47)}return e=Vt(e,!n),n?e.length>0?"/"+e:"/":e.length>0?e:"."},normalize:function(e){if(Q(e),e.length===0)return".";var n=e.charCodeAt(0)===47,a=e.charCodeAt(e.length-1)===47;return e=Vt(e,!n),e.length===0&&!n&&(e="."),e.length>0&&a&&(e+="/"),n?"/"+e:e},isAbsolute:function(e){return Q(e),e.length>0&&e.charCodeAt(0)===47},join:function(){if(arguments.length===0)return".";for(var e,n=0;n<arguments.length;++n){var a=arguments[n];Q(a),a.length>0&&(e===void 0?e=a:e+="/"+a)}return e===void 0?".":he.normalize(e)},relative:function(e,n){if(Q(e),Q(n),e===n||(e=he.resolve(e),n=he.resolve(n),e===n))return"";for(var a=1;a<e.length&&e.charCodeAt(a)===47;++a);for(var r=e.length,s=r-a,l=1;l<n.length&&n.charCodeAt(l)===47;++l);for(var o=n.length,i=o-l,u=s<i?s:i,g=-1,d=0;d<=u;++d){if(d===u){if(i>u){if(n.charCodeAt(l+d)===47)return n.slice(l+d+1);if(d===0)return n.slice(l+d)}else s>u&&(e.charCodeAt(a+d)===47?g=d:d===0&&(g=0));break}var v=e.charCodeAt(a+d),f=n.charCodeAt(l+d);if(v!==f)break;v===47&&(g=d)}var h="";for(d=a+g+1;d<=r;++d)(d===r||e.charCodeAt(d)===47)&&(h.length===0?h+="..":h+="/..");return h.length>0?h+n.slice(l+g):(l+=g,n.charCodeAt(l)===47&&++l,n.slice(l))},_makeLong:function(e){return e},dirname:function(e){if(Q(e),e.length===0)return".";for(var n=e.charCodeAt(0),a=n===47,r=-1,s=!0,l=e.length-1;l>=1;--l)if(n=e.charCodeAt(l),n===47){if(!s){r=l;break}}else s=!1;return r===-1?a?"/":".":a&&r===1?"//":e.slice(0,r)},basename:function(e,n){if(n!==void 0&&typeof n!="string")throw new TypeError('"ext" argument must be a string');Q(e);var a=0,r=-1,s=!0,l;if(n!==void 0&&n.length>0&&n.length<=e.length){if(n.length===e.length&&n===e)return"";var o=n.length-1,i=-1;for(l=e.length-1;l>=0;--l){var u=e.charCodeAt(l);if(u===47){if(!s){a=l+1;break}}else i===-1&&(s=!1,i=l+1),o>=0&&(u===n.charCodeAt(o)?--o===-1&&(r=l):(o=-1,r=i))}return a===r?r=i:r===-1&&(r=e.length),e.slice(a,r)}else{for(l=e.length-1;l>=0;--l)if(e.charCodeAt(l)===47){if(!s){a=l+1;break}}else r===-1&&(s=!1,r=l+1);return r===-1?"":e.slice(a,r)}},extname:function(e){Q(e);for(var n=-1,a=0,r=-1,s=!0,l=0,o=e.length-1;o>=0;--o){var i=e.charCodeAt(o);if(i===47){if(!s){a=o+1;break}continue}r===-1&&(s=!1,r=o+1),i===46?n===-1?n=o:l!==1&&(l=1):n!==-1&&(l=-1)}return n===-1||r===-1||l===0||l===1&&n===r-1&&n===a+1?"":e.slice(n,r)},format:function(e){if(e===null||typeof e!="object")throw new TypeError('The "pathObject" argument must be of type Object. Received type '+typeof e);return xa("/",e)},parse:function(e){Q(e);var n={root:"",dir:"",base:"",ext:"",name:""};if(e.length===0)return n;var a=e.charCodeAt(0),r=a===47,s;r?(n.root="/",s=1):s=0;for(var l=-1,o=0,i=-1,u=!0,g=e.length-1,d=0;g>=s;--g){if(a=e.charCodeAt(g),a===47){if(!u){o=g+1;break}continue}i===-1&&(u=!1,i=g+1),a===46?l===-1?l=g:d!==1&&(d=1):l!==-1&&(d=-1)}return l===-1||i===-1||d===0||d===1&&l===i-1&&l===o+1?i!==-1&&(o===0&&r?n.base=n.name=e.slice(1,i):n.base=n.name=e.slice(o,i)):(o===0&&r?(n.name=e.slice(1,l),n.base=e.slice(1,i)):(n.name=e.slice(o,l),n.base=e.slice(o,i)),n.ext=e.slice(l,i)),o>0?n.dir=e.slice(0,o-1):r&&(n.dir="/"),n},sep:"/",delimiter:":",win32:null,posix:null};he.posix=he;var $e=he;const ka=t=>q({url:"/api/storage/files",method:"post",data:t,config:{showDefaultMsg:!1}}),_r=t=>q({url:"/api/storage/file/item",method:"post",data:t,config:{responseIntercept:!1,showDefaultMsg:!1}}),Ir=()=>q({url:"/api/site/config/global",method:"get"}),Aa=t=>q({url:"/api/site/config/storage",method:"post",data:t}),$r=t=>q({url:"/api/short-link/batch/generate",method:"post",data:t});var Nt;const Ft=typeof window!="undefined",st=()=>{};function La(t,e=200,n={}){return function(a,r){return function(...s){a(()=>r.apply(this,s),{fn:r,thisArg:this,args:s})}}(function(a,r={}){let s,l;return o=>{const i=re(a),u=re(r.maxWait);if(s&&clearTimeout(s),i<=0||u!==void 0&&u<=0)return l&&(clearTimeout(l),l=null),o();u&&!l&&(l=setTimeout(()=>{s&&clearTimeout(s),l=null,o()},u)),s=setTimeout(()=>{l&&clearTimeout(l),l=null,o()},i)}}(e,n),t)}Ft&&((Nt=window==null?void 0:window.navigator)==null?void 0:Nt.userAgent)&&/iP(ad|hone|od)/.test(window.navigator.userAgent);var Ta=Object.defineProperty,Pa=Object.defineProperties,Ea=Object.getOwnPropertyDescriptors,Kt=Object.getOwnPropertySymbols,Fa=Object.prototype.hasOwnProperty,Ra=Object.prototype.propertyIsEnumerable,Wt=(t,e,n)=>e in t?Ta(t,e,{enumerable:!0,configurable:!0,writable:!0,value:n}):t[e]=n,Ma=(t,e)=>{for(var n in e||(e={}))Fa.call(e,n)&&Wt(t,n,e[n]);if(Kt)for(var n of Kt(e))Ra.call(e,n)&&Wt(t,n,e[n]);return t};const Rt=Ft?window:void 0;function Ee(...t){let e,n,a,r;if(typeof t[0]=="string"?([n,a,r]=t,e=Rt):[e,n,a,r]=t,!e)return st;let s=st;const l=Fe(()=>function(u){var g;const d=re(u);return(g=d==null?void 0:d.$el)!=null?g:d}(e),u=>{s(),u&&(u.addEventListener(n,a,r),s=()=>{u.removeEventListener(n,a,r),s=st})},{immediate:!0,flush:"post"}),o=()=>{l(),s()};var i;return i=o,Nn()&&Kn(i),o}function Da(t,e,n={}){const{target:a=Rt,eventName:r="keydown",passive:s=!1}=n,l=typeof(o=t)=="function"?o:typeof o=="string"?i=>i.key===o:Array.isArray(o)?i=>o.includes(i.key):o?()=>!0:()=>!1;var o;return Ee(a,r,i=>{l(i)&&e(i)},s)}const ut=typeof globalThis!="undefined"?globalThis:typeof window!="undefined"?window:typeof global!="undefined"?global:typeof self!="undefined"?self:{},ct="__vueuse_ssr_handlers__";ut[ct]=ut[ct]||{},ut[ct];var qt,we,za=Object.defineProperty,Oa=Object.defineProperties,Ba=Object.getOwnPropertyDescriptors,Ht=Object.getOwnPropertySymbols,_a=Object.prototype.hasOwnProperty,Ia=Object.prototype.propertyIsEnumerable,Gt=(t,e,n)=>e in t?za(t,e,{enumerable:!0,configurable:!0,writable:!0,value:n}):t[e]=n;function $a(t,e={}){var n,a;const r=(n=e.draggingElement)!=null?n:Rt,s=F((a=e.initialValue)!=null?a:{x:0,y:0}),l=F(),o=f=>!e.pointerTypes||e.pointerTypes.includes(f.pointerType),i=f=>{re(e.preventDefault)&&f.preventDefault(),re(e.stopPropagation)&&f.stopPropagation()},u=f=>{var h;o(f)&&l.value&&(s.value={x:f.pageX-l.value.x,y:f.pageY-l.value.y},(h=e.onMove)==null||h.call(e,s.value,f),i(f))},g=f=>{var h;o(f)&&l.value&&(l.value=void 0,(h=e.onEnd)==null||h.call(e,s.value,f),i(f))};return Ft&&(Ee(t,"pointerdown",f=>{var h;if(!o(f)||re(e.exact)&&f.target!==re(t))return;const x=re(t).getBoundingClientRect(),M={x:f.pageX-x.left,y:f.pageY-x.top};((h=e.onStart)==null?void 0:h.call(e,M,f))!==!1&&(l.value=M,i(f))},!0),Ee(r,"pointermove",u,!0),Ee(r,"pointerup",g,!0)),d=((f,h)=>{for(var x in h||(h={}))_a.call(h,x)&&Gt(f,x,h[x]);if(Ht)for(var x of Ht(h))Ia.call(h,x)&&Gt(f,x,h[x]);return f})({},function(f){if(!Un(f))return yt(f);const h=Array.isArray(f.value)?new Array(f.value.length):{};for(const x in f.value)h[x]=Vn(()=>({get:()=>f.value[x],set(M){if(Array.isArray(f.value)){const D=[...f.value];D[x]=M,f.value=D}else{const D=(P=Ma({},f.value),Pa(P,Ea({[x]:M})));Object.setPrototypeOf(D,f.value),f.value=D}var P}}));return h}(s)),v={position:s,isDragging:I(()=>!!l.value),style:I(()=>`left:${s.value.x}px;top:${s.value.y}px;`)},Oa(d,Ba(v));var d,v}(we=qt||(qt={})).UP="UP",we.RIGHT="RIGHT",we.DOWN="DOWN",we.LEFT="LEFT",we.NONE="NONE";const ja=["a","s","d","w","q","e","A","S","D","W","Q","E","ArrowUp","ArrowDown","ArrowLeft","ArrowRight","Escape"," "];var Ye=Dn({name:"V3ImgPreview",props:{showToolbar:{type:Boolean,default:!0},showArrowBtn:{type:Boolean,default:!0},keyboard:{type:Boolean,default:!0},url:{type:String,default:void 0},escClose:{type:Boolean,default:!0},images:{type:Array,default:()=>[]},showCloseBtn:{type:Boolean,default:!0},index:{type:Number,default:0},on_unmount_v3_ima_preview_app:{type:Function}},setup(t,e){let{emit:n}=e;const a=F(null),r=F(null),{style:s}=$a(r),l=ve({visible:!0,imgState:"loading",src:"",imgIndex:t.index}),o=I(()=>{var S;return((S=t.images)===null||S===void 0?void 0:S.length)>1&&t.showArrowBtn}),i=ve({imgScale:1,imgRotate:0}),u=I(()=>{var S;return((S=t.images)===null||S===void 0?void 0:S.length)>1}),g=La(S=>{if(!t.keyboard)return!1;S.preventDefault();const{key:w}=S;return["s","S","ArrowDown"].includes(w)?f(-.1,!1):["w","W","ArrowUp"].includes(w)?f(.1,!1):w===" "?d():w==="Escape"&&t.escClose?P():["E","e"].includes(w)?v(!0):["Q","q"].includes(w)?v(!1):["a","A","ArrowLeft"].includes(w)?D(!1):["d","D","ArrowRight"].includes(w)?D(!0):void 0},200);Da(ja,g);const d=()=>{i.imgScale=1,i.imgRotate=0,r.value.style.top="0",r.value.style.left="0"};function v(S){i.imgRotate+=90*(S?1:-1)}function f(S){let w=arguments.length>1&&arguments[1]!==void 0&&arguments[1];i.imgScale<=.2&&S<0||(w?i.imgScale=S:i.imgScale+=S)}function h(S){S.preventDefault(),f(S.deltaY<0?.05:-.05)}function x(S){l.imgState="loading",(w=>{const c=new Image;return c.src=w,new Promise((m,p)=>{c.onload=()=>{m(w)},c.onerror=()=>{p(w)}})})(S).then(()=>{l.imgState="success",l.src=S,d()}).catch(()=>{l.imgState="error"})}function M(){qe(()=>{Ee(a.value,"mousewheel",h,!1),d(),qe(()=>t.url!==void 0?x(t.url):Array.isArray(t.images)&&t.images.length>0?x(t.images[l.imgIndex]):console.error("images is not Array or Array length is 0"))})}function P(){var S;l.visible=!1,n("close"),(S=t.on_unmount_v3_ima_preview_app)===null||S===void 0||S.call(t)}function D(S){u.value&&(S?(l.imgIndex++,l.imgIndex>t.images.length-1&&(l.imgIndex=0)):(l.imgIndex--,l.imgIndex<0&&(l.imgIndex=t.images.length-1)),x(t.images[l.imgIndex]))}return zn(()=>{window.__V3__IMG__PREVIEW__LOAD__ICON__SVG__||function(S){S.__V3__IMG__PREVIEW__LOAD__ICON__SVG__=!0;var w,c,m,p,y,C='<svg><symbol id="v3-img-close" viewBox="0 0 1045 1024"><path d="M282.517333 213.376l-45.354666 45.162667L489.472 512 237.162667 765.461333l45.354666 45.162667L534.613333 557.354667l252.096 253.269333 45.354667-45.162667-252.288-253.44 252.288-253.482666-45.354667-45.162667L534.613333 466.624l-252.096-253.226667z"  ></path></symbol><symbol id="v3-img-img-error" viewBox="0 0 1024 1024"><path d="M704 328a72 72 0 1 0 144 0 72 72 0 1 0-144 0z"  ></path><path d="M999.904 116.608a32 32 0 0 0-21.952-10.912L521.76 73.792a31.552 31.552 0 0 0-27.2 11.904l-92.192 114.848a32 32 0 0 0 0.672 40.896l146.144 169.952-147.456 194.656 36.48-173.376a32 32 0 0 0-11.136-31.424L235.616 245.504l79.616-125.696a32 32 0 0 0-29.28-49.024L45.76 87.552a32 32 0 0 0-29.696 34.176l55.808 798.016a32.064 32.064 0 0 0 34.304 29.696l176.512-13.184c17.632-1.312 30.848-16.672 29.504-34.272s-16.576-31.04-34.304-29.536L133.44 883.232l-6.432-92.512 125.312-12.576a32 32 0 0 0 28.672-35.04 32.16 32.16 0 0 0-35.04-28.672L122.56 726.848 82.144 149.184l145.152-10.144-60.96 96.224a32 32 0 0 0 6.848 41.952l198.4 161.344-58.752 279.296a30.912 30.912 0 0 0 0.736 14.752 31.68 31.68 0 0 0 1.408 11.04l51.52 154.56a31.968 31.968 0 0 0 27.456 21.76l523.104 47.552a32.064 32.064 0 0 0 34.848-29.632l55.776-798.048a32.064 32.064 0 0 0-7.776-23.232z m-98.912 630.848l-412.576-39.648a31.52 31.52 0 0 0-34.912 28.768 32 32 0 0 0 28.8 34.912l414.24 39.808-6.272 89.536-469.728-42.72-39.584-118.72 234.816-310.016a31.936 31.936 0 0 0-1.248-40.192L468.896 219.84l65.088-81.056 407.584 28.48-40.576 580.192z"  ></path></symbol><symbol id="v3-img-loading" viewBox="0 0 1024 1024"><path d="M834.7648 736.3584a5.632 5.632 0 1 0 11.264 0 5.632 5.632 0 0 0-11.264 0z m-124.16 128.1024a11.1616 11.1616 0 1 0 22.3744 0 11.1616 11.1616 0 0 0-22.3744 0z m-167.3216 65.8944a16.7936 16.7936 0 1 0 33.6384 0 16.7936 16.7936 0 0 0-33.6384 0zM363.1616 921.6a22.3744 22.3744 0 1 0 44.7488 0 22.3744 22.3744 0 0 0-44.7488 0z m-159.744-82.0224a28.0064 28.0064 0 1 0 55.9616 0 28.0064 28.0064 0 0 0-56.0128 0zM92.672 700.16a33.6384 33.6384 0 1 0 67.2256 0 33.6384 33.6384 0 0 0-67.2256 0zM51.2 528.9984a39.168 39.168 0 1 0 78.336 0 39.168 39.168 0 0 0-78.336 0z m34.1504-170.0864a44.8 44.8 0 1 0 89.6 0 44.8 44.8 0 0 0-89.6 0zM187.904 221.7984a50.432 50.432 0 1 0 100.864 0 50.432 50.432 0 0 0-100.864 0zM338.432 143.36a55.9616 55.9616 0 1 0 111.9232 0 55.9616 55.9616 0 0 0-111.9744 0z m169.0112-4.9152a61.5936 61.5936 0 1 0 123.2384 0 61.5936 61.5936 0 0 0-123.2384 0z m154.7776 69.632a67.1744 67.1744 0 1 0 134.3488 0 67.1744 67.1744 0 0 0-134.3488 0z m110.0288 130.816a72.8064 72.8064 0 1 0 145.5616 0 72.8064 72.8064 0 0 0-145.5616 0z m43.7248 169.472a78.3872 78.3872 0 1 0 156.8256 0 78.3872 78.3872 0 0 0-156.8256 0z" fill="" ></path></symbol><symbol id="v3-img-right" viewBox="0 0 1024 1024"><path d="M884.808356 96.170317c0-17.780969-16.723893-32.209586-37.309744-32.209586-20.586874 0-37.310767 14.428617-37.310767 32.209586V927.20035c0 17.780969 16.723893 32.209586 37.310767 32.209586 20.585851 0 37.309744-14.428617 37.309744-32.209586V96.170317zM263.249101 159.859871c-27.619034-21.278629-50.027393-11.659551-50.027393 22.116717v659.490146c0 33.44881 22.481014 43.322691 50.027393 22.116716l407.352615-313.385476c27.65485-21.242813 27.618011-55.784514 0-76.989465L263.249101 159.859871z m449.327612 260.298398c60.265572 48.751331 60.301388 134.302799 0 183.090968L297.061185 939.297876c-70.976518 57.422827-158.459988-25.322735-158.459989-116.158556V200.267163c0-91.12644 87.445608-173.6172 158.459989-116.158557l415.515528 336.049663zM297.061185 84.10963"  ></path></symbol><symbol id="v3-img-left" viewBox="0 0 1024 1024"><path d="M138.60222 96.170317V927.20035c0 17.780969 16.723893 32.209586 37.309744 32.209586 20.586874 0 37.310767-14.428617 37.310767-32.209586V96.170317c0-17.780969-16.723893-32.209586-37.310767-32.209586-20.585851 0-37.309744 14.428617-37.309744 32.209586z m621.560278 63.689554L352.80886 473.208509c-27.618011 21.205974-27.65485 55.747675 0 76.989465l407.353638 313.385476c27.54638 21.205974 50.027393 11.33107 50.027393-22.116716v-659.490146c-0.001023-33.776268-22.408359-43.395346-50.027393-22.116717z m-33.812084-75.750241c71.013357-57.459666 158.458965 25.032116 158.458965 116.157533v622.872157c0 90.835821-87.482447 173.581384-158.459988 116.158556L310.834886 603.249237c-60.301388-48.78817-60.265572-134.339638 0-183.090968L726.350414 84.10963z m0 0"  ></path></symbol><symbol id="v3-img-zoom-out" viewBox="0 0 1024 1024"><path d="M919.264 905.984l-138.912-138.912C851.808 692.32 896 591.328 896 480c0-229.376-186.624-416-416-416S64 250.624 64 480s186.624 416 416 416c95.008 0 182.432-32.384 252.544-86.208l141.44 141.44a31.904 31.904 0 0 0 45.248 0 32 32 0 0 0 0.032-45.248zM128 480C128 285.92 285.92 128 480 128s352 157.92 352 352-157.92 352-352 352S128 674.08 128 480z"  ></path><path d="M625.792 448H336a32 32 0 0 0 0 64h289.792a32 32 0 1 0 0-64z"  ></path></symbol><symbol id="v3-img-zoom-big" viewBox="0 0 1024 1024"><path d="M919.264 905.984l-138.912-138.912C851.808 692.32 896 591.328 896 480c0-229.376-186.624-416-416-416S64 250.624 64 480s186.624 416 416 416c95.008 0 182.432-32.384 252.544-86.208l141.44 141.44a31.904 31.904 0 0 0 45.248 0 32 32 0 0 0 0.032-45.248zM128 480C128 285.92 285.92 128 480 128s352 157.92 352 352-157.92 352-352 352S128 674.08 128 480z"  ></path><path d="M625.792 448H512v-112a32 32 0 0 0-64 0V448h-112a32 32 0 0 0 0 64H448v112a32 32 0 1 0 64 0V512h113.792a32 32 0 1 0 0-64z"  ></path></symbol><symbol id="v3-img-rotate-left" viewBox="0 0 1024 1024"><path d="M884.565333 431.914667c-3.114667 36.266667-22.784 55.893333-59.008 59.008-35.2-3.114667-54.357333-22.741333-57.472-59.008 3.114667-35.157333 22.272-54.314667 57.472-57.429334 36.224 3.114667 55.893333 22.272 59.008 57.429334z m-97.834666 0c3.114667 24.874667 16.042667 38.826667 38.826666 41.941333 22.741333-2.048 35.712-16.042667 38.826667-41.941333-3.114667-24.832-16.085333-38.272-38.826667-40.362667-22.784 3.114667-35.712 16.597333-38.826666 40.362667z m-59.008 82.346666c-1.024 103.466667-34.688 156.245333-100.906667 158.293334-69.376-1.024-104.021333-53.76-104.021333-158.293334 0.981333-104.576 35.157333-158.421333 102.442666-161.536 67.285333 2.133333 101.461333 55.893333 102.485334 161.493334z m-169.216 0c0 89.002667 22.229333 132.992 66.730666 131.925334 44.501333 1.066667 66.773333-42.922667 66.773334-131.968 0-90.026667-22.784-134.528-68.309334-133.546667-42.453333 3.114667-64.213333 47.658667-65.194666 133.546667z m-184.746667 49.664c-58.026667-5.205333-89.6-39.338667-94.72-102.485333 4.096-67.285333 37.76-103.509333 100.906667-108.714667 72.448-0.981333 108.16 50.218667 107.093333 153.728 0 109.738667-37.76 165.12-113.322667 166.144-45.568-2.090667-74.538667-24.32-86.954666-66.773333l32.597333-10.88c7.253333 36.266667 26.453333 53.845333 57.472 52.821333 48.64-2.090667 73.472-45.056 74.538667-128.853333-15.530667 29.994667-41.429333 45.013333-77.653334 45.013333z m3.072-181.674666c-39.338667 3.114667-60.586667 28.458667-63.658667 76.074666 2.048 47.616 23.296 72.96 63.658667 76.074667 40.362667 0 65.194667-18.645333 74.538667-55.893333 0-65.194667-24.874667-97.28-74.538667-96.256z m135.594667 641.578666C230.186667 1023.829333 0.597333 794.24 0.597333 512v-0.981333h53.973334v0.981333c0 252.501333 205.354667 457.898667 457.813333 457.898667 252.501333 0 457.898667-205.397333 457.898667-457.898667 0-252.458667-205.397333-457.813333-457.856-457.813333A457.088 457.088 0 0 0 159.530667 220.586667l120.533333-0.938667h8.106667l-47.061334 47.786667-167.936 1.365333-1.109333-167.936 47.189333-47.872v131.626667A510.933333 510.933333 0 0 1 512.426667 0.128C794.624 0.128 1024.256 229.76 1024.256 512c0 282.282667-229.632 511.872-511.829333 511.872z"  ></path></symbol><symbol id="v3-img-antetype" viewBox="0 0 1024 1024"><path d="M316 672h60c4.4 0 8-3.6 8-8V360c0-4.4-3.6-8-8-8h-60c-4.4 0-8 3.6-8 8v304c0 4.4 3.6 8 8 8zM512 622c22.1 0 40-17.9 40-39 0-23.1-17.9-41-40-41s-40 17.9-40 41c0 21.1 17.9 39 40 39zM512 482c22.1 0 40-17.9 40-39 0-23.1-17.9-41-40-41s-40 17.9-40 41c0 21.1 17.9 39 40 39z"  ></path><path d="M880 112H144c-17.7 0-32 14.3-32 32v736c0 17.7 14.3 32 32 32h736c17.7 0 32-14.3 32-32V144c0-17.7-14.3-32-32-32z m-40 728H184V184h656v656z"  ></path><path d="M648 672h60c4.4 0 8-3.6 8-8V360c0-4.4-3.6-8-8-8h-60c-4.4 0-8 3.6-8 8v304c0 4.4 3.6 8 8 8z"  ></path></symbol><symbol id="v3-img-rotate-right" viewBox="0 0 1024 1024"><path d="M375.381 562.517c-57.898-5.162-89.472-39.296-94.634-102.4 4.138-67.2 37.76-103.381 100.864-108.586 72.362-1.024 108.032 50.176 107.008 153.6 0 109.61-37.76 164.906-113.238 165.973-45.525-2.133-74.453-24.32-86.869-66.73l32.597-10.838c7.211 36.181 26.368 53.76 57.387 52.736 48.597-2.048 73.387-44.97 74.453-128.768-15.488 29.995-41.386 45.013-77.568 45.013z m3.115-181.504c-39.296 3.072-60.501 28.459-63.573 75.99 2.048 47.573 23.253 72.96 63.573 76.032 40.32 0 65.152-18.603 74.453-55.851 0-65.152-24.832-97.195-74.453-96.17z m145.835 131.84c0.981-104.448 35.114-158.208 102.4-161.322 67.157 2.09 101.29 55.85 102.357 161.322-1.067 103.424-34.688 156.16-100.821 158.251-69.334-1.067-103.936-53.76-103.936-158.25z m169.088 0c0-89.984-22.784-134.4-68.267-133.418-42.41 3.114-64.128 47.616-65.152 133.418 0 88.96 22.187 132.907 66.688 131.84 44.459 1.067 66.73-42.88 66.73-131.84z m75.989-82.218c3.115-35.158 22.23-54.272 57.387-57.387 36.181 3.115 55.893 22.23 58.965 57.387-3.115 36.224-22.784 55.893-58.965 58.965-35.158-3.115-54.272-22.741-57.387-58.965z m96.17 0c-3.071-24.832-16.042-38.23-38.783-40.32-22.742 3.114-35.67 16.554-38.784 40.32 3.114 24.832 16.042 38.826 38.826 41.898 22.699-2.048 35.67-16.042 38.742-41.898z m-354.175 592.64c-281.984 0-511.36-229.376-511.36-511.403C0 229.973 229.419 0.512 511.403 0.512c157.696 0 298.922 71.765 392.789 184.32V54.613l47.147 47.872-1.11 167.766-167.765-1.366-47.061-47.744h8.106l121.558 0.982a456.704 456.704 0 0 0-353.664-167.68c-252.246 0-457.43 205.226-457.43 457.429 0 252.288 205.184 457.515 457.43 457.515S968.875 764.16 968.875 511.872v-0.981h53.888v0.981c0 282.027-229.376 511.403-511.36 511.403z"  ></path></symbol></svg>',k=(k=document.getElementsByTagName("script"))[k.length-1].getAttribute("data-injectcss");if(k&&!S.__iconfont__svg__cssinject__){S.__iconfont__svg__cssinject__=!0;try{document.write("<style>.svgfont {display: inline-block;width: 1em;height: 1em;fill: currentColor;vertical-align: -0.1em;font-size:16px;}</style>")}catch(E){console&&console.log(E)}}function R(){y||(y=!0,m())}w=function(){var E,A=document.createElement("div");A.innerHTML=C,C=null,(A=A.getElementsByTagName("svg")[0])&&(A.setAttribute("aria-hidden","true"),A.style.position="absolute",A.style.width=0,A.style.height=0,A.style.overflow="hidden",(E=document.body).firstChild?function(Y,b){b.parentNode.insertBefore(Y,b)}(A,E.firstChild):E.appendChild(A))},document.addEventListener?~["complete","loaded","interactive"].indexOf(document.readyState)?setTimeout(w,0):(c=function(){document.removeEventListener("DOMContentLoaded",c,!1),w()},document.addEventListener("DOMContentLoaded",c,!1)):document.attachEvent&&(m=w,p=S.document,y=!1,function E(){try{p.documentElement.doScroll("left")}catch(A){return void setTimeout(E,50)}R()}(),p.onreadystatechange=function(){p.readyState=="complete"&&(p.onreadystatechange=null,R())})}(typeof window!="undefined"?window:global),M()}),Object.assign(Object.assign(Object.assign({vImagesWrap:a,imgContainer:r},yt(l)),yt(i)),{handleClose:P,toggleImg:D,initImgSize:d,dragStyle:s,handleScale:f,handleRotate:v,visibleArrowBtn:o,isMultiple:u,handleClickMaskClose:function(S){S.target.classList.contains("img-container")&&P()}})}});const J=t=>(On("data-v-50804152"),t=t(),Bn(),t),Ua={class:"icon img-loading rotate-animation","aria-hidden":"true"},Va=[J(()=>_("use",{"xlink:href":"#v3-img-loading"},null,-1))],Na=["src"],Ka=[J(()=>_("use",{"xlink:href":"#v3-img-img-error"},null,-1))],Wa=[J(()=>_("use",{"xlink:href":"#v3-img-close"},null,-1))],qa=[J(()=>_("svg",{class:"icon","aria-hidden":"true"},[_("use",{"xlink:href":"#v3-img-left"})],-1))],Ha=[J(()=>_("svg",{class:"icon","aria-hidden":"true"},[_("use",{"xlink:href":"#v3-img-right"})],-1))],Ga={key:3,class:"v3-img-preview-toolbar"},Ya=[J(()=>_("use",{"xlink:href":"#v3-img-zoom-out"},null,-1))],Qa=[J(()=>_("use",{"xlink:href":"#v3-img-zoom-big"},null,-1))],Xa=[J(()=>_("use",{"xlink:href":"#v3-img-antetype"},null,-1))],Za=[J(()=>_("use",{"xlink:href":"#v3-img-rotate-left"},null,-1))],Ja=[J(()=>_("use",{"xlink:href":"#v3-img-rotate-right"},null,-1))];(function(t,e){e===void 0&&(e={});var n=e.insertAt;if(t&&typeof document!="undefined"){var a=document.head||document.getElementsByTagName("head")[0],r=document.createElement("style");r.type="text/css",n==="top"&&a.firstChild?a.insertBefore(r,a.firstChild):a.appendChild(r),r.styleSheet?r.styleSheet.cssText=t:r.appendChild(document.createTextNode(t))}})(`.icon[data-v-50804152] {
  width: 1em;
  height: 1em;
  vertical-align: -0.15em;
  fill: currentColor;
  overflow: hidden;
}
.v-images-wrap[data-v-50804152] {
  z-index: 200;
  user-select: none;
  position: fixed;
  top: 0;
  left: 0;
  width: 100vw;
  height: 100vh;
  overflow: hidden;
  background: rgba(0, 0, 0, 0.3);
  backdrop-filter: blur(3px);
  color: #fff;
}
.v-images-wrap[data-v-50804152] .img-loading[data-v-50804152],
.v-images-wrap[data-v-50804152] .img-content[data-v-50804152] {
  font-size: 50px;
  position: absolute;
  top: 0;
  left: 0;
  right: 0;
  bottom: 0;
  margin: auto;
  transition: all 0.2s;
  cursor: move;
}
.v-images-wrap[data-v-50804152] .img-container[data-v-50804152] {
  z-index: 201;
  position: absolute;
  height: 100vh;
  width: 100vw;
  top: 0;
  left: 0;
  text-align: center;
}
.v-images-wrap[data-v-50804152] .img-container[data-v-50804152] .img-content[data-v-50804152] {
  max-width: 100%;
  max-height: 100%;
}
.v-images-wrap[data-v-50804152] .img-container[data-v-50804152] .img-error[data-v-50804152] {
  font-size: 300px;
  color: #d8d8d8;
}
.v-images-wrap[data-v-50804152] .rotate-animation[data-v-50804152] {
  animation: rotate-50804152 1.5s linear infinite;
}
.v-images-wrap[data-v-50804152] .arrow[data-v-50804152] {
  width: 42px;
  height: 42px;
  text-align: center;
  line-height: 42px;
  position: absolute;
  top: 50%;
  border-radius: 50%;
  transform: translateY(-50%);
  -ms-transform: translateY(-50%);
  font-size: 24px;
  cursor: pointer;
  transition: all 0.2s;
  z-index: 280;
  background: rgba(0, 0, 0, 0.3);
}
.v-images-wrap[data-v-50804152] .arrow[data-v-50804152][data-v-50804152]:hover {
  opacity: 0.8;
  transform: translateY(-50%) scale(1.2);
}
.v-images-wrap[data-v-50804152] .arrow-left[data-v-50804152] {
  left: 50px;
}
.v-images-wrap[data-v-50804152] .arrow-right[data-v-50804152] {
  right: 50px;
}
.v-images-wrap[data-v-50804152] .close-btn[data-v-50804152] {
  z-index: 205;
  position: absolute;
  right: 50px;
  top: 50px;
  width: 36px;
  height: 36px;
  font-size: 22px;
  line-height: 36px;
  text-align: center;
  border-radius: 50%;
  cursor: pointer;
  transition: all 0.2s;
  color: #e7e5e5;
  background: rgba(0, 0, 0, 0.3);
}
.v-images-wrap[data-v-50804152] .close-btn[data-v-50804152][data-v-50804152]:hover {
  opacity: 0.8;
  transform: scale(1.2);
}
.v-images-wrap[data-v-50804152] .v3-img-preview-toolbar[data-v-50804152] {
  z-index: 205;
  position: absolute;
  bottom: 10%;
  font-size: 26px;
  width: 100%;
  display: flex;
  justify-content: center;
  cursor: pointer;
}
.v-images-wrap[data-v-50804152] .v3-img-preview-toolbar[data-v-50804152] section[data-v-50804152] {
  height: 44px;
  bottom: 10%;
  padding: 0 22px;
  display: flex;
  align-items: center;
  border-radius: 22px;
  background: rgba(0, 0, 0, 0.3);
  color: #c3c3c3;
}
.v-images-wrap[data-v-50804152] .v3-img-preview-toolbar[data-v-50804152] section[data-v-50804152] svg[data-v-50804152] {
  box-sizing: content-box;
  padding: 0 10px;
  transition: all 0.2s;
}
.v-images-wrap[data-v-50804152] .v3-img-preview-toolbar[data-v-50804152] section[data-v-50804152] svg[data-v-50804152][data-v-50804152]:hover {
  transform: scale(1.2);
}
@keyframes rotate-50804152 {
  from {
    transform: rotate(0deg);
  }
  to {
    transform: rotate(360deg);
  }
}
`),Ye.render=function(t,e,n,a,r,s){return j(),_n($n,{name:"fade"},{default:In(()=>[t.visible?(j(),K("div",{key:0,class:"v-images-wrap",onClick:e[10]||(e[10]=function(){return t.handleClickMaskClose&&t.handleClickMaskClose(...arguments)}),ref:"vImagesWrap"},[tt((j(),K("svg",Ua,Va,512)),[[nt,t.imgState==="loading"]]),_("div",{ref:"imgContainer",style:rt(t.dragStyle),class:"img-container"},[tt(_("img",{class:"img-content",onDragstart:e[0]||(e[0]=at(()=>{},["prevent"])),src:t.src,style:rt(`transform: scale(${t.imgScale}) rotate(${t.imgRotate}deg);`),alt:""},null,44,Na),[[nt,t.imgState==="success"]]),tt((j(),K("svg",{class:"icon img-content img-error",onDragstart:e[1]||(e[1]=at(()=>{},["prevent"])),"aria-hidden":"true",style:rt(`transform: scale(${t.imgScale}) rotate(${t.imgRotate}deg);`)},Ka,36)),[[nt,t.imgState==="error"]])],4),t.showCloseBtn?(j(),K("svg",{key:0,class:"icon close-btn","aria-hidden":"true",onClick:e[2]||(e[2]=at(function(){return t.handleClose&&t.handleClose(...arguments)},["stop"]))},Wa)):ye("",!0),t.visibleArrowBtn?(j(),K("div",{key:1,class:"arrow arrow-left",onClick:e[3]||(e[3]=l=>t.toggleImg(!1))},qa)):ye("",!0),t.visibleArrowBtn?(j(),K("div",{key:2,class:"arrow arrow-right",onClick:e[4]||(e[4]=l=>t.toggleImg(!0))},Ha)):ye("",!0),t.showToolbar?(j(),K("div",Ga,[_("section",null,[(j(),K("svg",{class:"icon","aria-hidden":"true",onClick:e[5]||(e[5]=l=>t.handleScale(-.1,!1))},Ya)),(j(),K("svg",{class:"icon","aria-hidden":"true",onClick:e[6]||(e[6]=l=>t.handleScale(.1,!1))},Qa)),(j(),K("svg",{class:"icon","aria-hidden":"true",onClick:e[7]||(e[7]=function(){return t.initImgSize&&t.initImgSize(...arguments)})},Xa)),(j(),K("svg",{class:"icon","aria-hidden":"true",onClick:e[8]||(e[8]=l=>t.handleRotate(!1))},Za)),(j(),K("svg",{class:"icon","aria-hidden":"true",onClick:e[9]||(e[9]=l=>t.handleRotate(!0))},Ja))])])):ye("",!0)],512)):ye("",!0)]),_:1})},Ye.__scopeId="data-v-50804152";let An={};const Yt="v3-img-preview-container-id";let Se={};function Ln(t){if(Se._instance)return!1;Array.isArray(t)&&(t={images:t}),typeof t=="string"&&(t={url:t}),t=Object.assign(Object.assign({},An),t);let e=document.getElementById(Yt);return e||(e=document.createElement("div"),e.id=Yt,document.body.appendChild(e)),Se=jn(Ye,Object.assign(Object.assign({},t),{on_unmount_v3_ima_preview_app:()=>Se.unmount()})),Se.mount(e),Se}(()=>{const t=Ye;return t.install=(e,n)=>{An=n,e.config.globalProperties.$v3ImgPreviewFn=Ln},t})();let er=Tt(),dt=me(),Qt=F(!1),Xt=F(!1),Zt=F(!1),Jt=F(!1),en=F(!1);function tr(){return{openVideo:()=>{Qt.value=!0},dialogVideoVisible:Qt,openText:()=>{Xt.value=!0},dialogTextVisible:Xt,openOffice:()=>{Zt.value=!0},dialogOfficeVisible:Zt,openImage:o=>{let i=[],u=0;er.zfileConfig.imagePreview.mode==="only"?i.push(o.url):dt.filterFileByType("image").forEach((d,v)=>{o.name===d.name&&(u=v),i.push(d.url)}),Ln({images:i,index:u})},openAudio:()=>{dt.updateAudioList(dt.filterFileByType("audio"))},openPdf:()=>{Jt.value=!0},dialogPdfVisible:Jt,open3d:()=>{en.value=!0},dialog3dVisible:en}}const{encodeAllIgnoreSlashes:tn}=qn();let{routerRef:Ce,fullpath:ft,storageKey:X,currentPath:je}=Me(),{getPathPwd:nr,putPathPwd:ar}=Et();const{storageListAsFileList:rr}=Yn();let xe=me(),pe=De();const gt=Rn(pe.globalConfig.siteName);let Ct=Tt();const{openAudio:lr,openImage:or,openOffice:ir,openPdf:sr,openText:ur,openVideo:cr,open3d:dr}=tr(),ge=F(!1),nn=F(!1);let xt=ve([]);if(xt.length===0)for(let t=0;t<Ct.zfileConfig.skeleton.size;t++)xt.push({});let Z=ve({path:"",password:"",orderBy:"",orderDirection:""});const an=F(!1);let{selectRows:fr,clearSelection:gr}=Qe();function Tn(){const t=({prop:o,order:i})=>{Z.orderBy=o,Z.orderDirection=i==="descending"?"desc":"asc",e()},e=o=>{if(!X.value)return;ge.value=!0,Z.path=je.value;let i=o||{};i.storageKey=X.value,i.path=je.value,i.password=i.password||nr(),i.orderBy=Z.orderBy,i.orderDirection=Z.orderDirection;let u=X.value;ka(i).then(g=>{let d=g.data.passwordPattern;if(ar(d,i.password),u!==X.value)return;let v=g.data.files,f=Z.path;if(f!==""&&f!=="/"){let h=$e.basename($e.resolve(je.value,"../"));v.unshift({name:h||"/",path:$e.resolve(f,"../"),type:"BACK"})}xe.updateFileList(v),ge.value=!1,nn.value=!0,fr.value=[],ft.value?gt.value=pe.globalConfig.siteName+" | "+ft.value[ft.value.length-1]:gt.value=pe.globalConfig.siteName+" | \u9996\u9875",n(i)}).catch(g=>{let d=g.response.data;d.code===V.responseCode.INVALID_PASSWORD?(W.warning("\u5BC6\u7801\u9519\u8BEF\uFF0C\u8BF7\u91CD\u65B0\u8F93\u5165\uFF01"),l()):d.code===V.responseCode.REQUIRED_PASSWORD?(W.warning("\u6B64\u6587\u4EF6\u5939\u9700\u8981\u5BC6\u7801\uFF0C\u8BF7\u8F93\u5165\u5BC6\u7801\uFF01"),l()):W.error(d.msg)})},n=o=>{let i={storageKey:X.value,path:je.value,password:o.password};Aa(i).then(u=>{pe.updateFolderConfig(u.data),X.value!==xe.oldStorageKey&&xe.updateOldStorageKey(X.value)}).finally(()=>{an.value=!0})},a=o=>{if(!!o.name)if(xe.updateCurrentClickRow(o),o.type==="FILE"){const{batchDownloadFile:i}=Pn();switch(o.fileType){case"video":cr();break;case"image":or(o);break;case"text":ur();break;case"audio":lr(o);break;case"office":ir(o);break;case"pdf":sr(o);break;case"three3d":dr(o);break;default:i(o)}gr()}else if(o.type==="ROOT")Ce.value.push(o.path);else if(o.type==="BACK"){let i=He("/"+X.value+"/"+o.path);i=tn(i),Ce.value.push(i)}else{let i=He("/"+X.value+"/"+o.path+"/"+o.name);i=tn(i),Ce.value.push(i)}};let r=I(()=>{let o=Ct.zfileConfig.skeleton.enable,i=Ct.zfileConfig.skeleton.show;return o?i==="always"?ge.value:nn.value?!1:ge.value:!1}),s=I(()=>r.value?!1:ge.value),l=()=>{oe.prompt("\u6B64\u6587\u4EF6\u5939\u5DF2\u52A0\u5BC6\uFF0C\u8BF7\u8F93\u5165\u5BC6\u7801","\u63D0\u793A",{confirmButtonText:"\u786E\u5B9A",cancelButtonText:"\u53D6\u6D88",inputType:"password",inputValidator(o){return!!o},inputErrorMessage:"\u5BC6\u7801\u4E0D\u80FD\u4E3A\u7A7A."}).then(({value:o})=>{e({password:o})}).catch(()=>{if((Z.path==="/"||Z.path==="")&&pe.globalConfig.rootShowStorage===!0)xe.updateFileList(rr.value),Ce.value.push("/"),gt.value=pe.globalConfig.siteName+" | \u9996\u9875",ge.value=!1;else{let o=$e.resolve(Z.path,"../");Ce.value.push("/"+X.value+o)}})};return{loadFile:e,openRow:a,searchParam:Z,sortChangeMethod:t,skeletonLoading:r,skeletonData:xt,basicLoading:s,initStorageConfig:an,loadFileConfig:n}}let pr=me(),hr=De(),{storageKey:pt,currentPath:rn}=Me(),{selectRows:H,selectRow:vr,selectFolders:Ue,selectFiles:ht}=Qe(),{getPathPwd:mr}=Et();const ln=Wn();function Pn(){const{loadFile:t}=Tn(),e=u=>{if(!H.value&&H.value.length===0){W.warning("\u8BF7\u81F3\u5C11\u9009\u62E9\u4E00\u4E2A\u6587\u4EF6");return}let g;const v=(()=>{let f={isChrome:!1,tips:""},h=ln.browser,x=ln.version;return h==="Chrome"?f.isChrome=!0:f.tips=`<br><span class="text-gray-500 text-xs">\u68C0\u6D4B\u5230\u5F53\u524D\u6D4F\u89C8\u5668\u4E3A <b>${h}-${x}</b>, \u53EF\u80FD\u4E0D\u652F\u6301\u6B64\u529F\u80FD\uFF0C\u5EFA\u8BAE\u4F7F\u7528\u8C37\u6B4C\u6D4F\u89C8\u5668!</span>`,f})();u!=null&&u.name?g=`\u662F\u5426\u786E\u8BA4\u4E0B\u8F7D\u6587\u4EF6 <span class="text-blue-500">${u.name}</span> \uFF1F`:H.value.length===1?(g=`\u662F\u5426\u786E\u8BA4\u4E0B\u8F7D\u6587\u4EF6 <span class="text-blue-500">${H.value[0].name}</span> \uFF1F`,u=H.value[0]):H.value.length>1&&(g=`\u662F\u5426\u786E\u8BA4\u6279\u91CF\u4E0B\u8F7D ${H.value.length} \u4E2A\u6587\u4EF6\uFF1F`,v.isChrome||(g+=v.tips)),oe.confirm(g,"\u63D0\u793A",{dangerouslyUseHTMLString:!0,confirmButtonText:"\u786E\u5B9A",cancelButtonText:"\u53D6\u6D88",type:"info",callback:f=>{f==="confirm"&&(u!=null&&u.name?(console.log("\u8FDB\u884C\u6307\u5B9A\u6587\u4EF6\u4E0B\u8F7D, \u6587\u4EF6:",u),n(u.url)):H.value.forEach(h=>{h.type==="FILE"&&(console.log("\u6279\u91CF\u9009\u4E2D\u6587\u4EF6\u4E0B\u8F7D, \u6587\u4EF6:",h),a(h.url))}))}})},n=u=>{window.open(u)},a=u=>{const g=document.createElement("iframe");g.style.display="none",g.style.height=0,g.src=u,document.body.appendChild(g),setTimeout(()=>{g.remove()},5*60*1e3)};return{batchDownloadFile:e,rename:()=>{let u=vr.value;if(u===null){W.warning("\u8BF7\u5148\u9009\u4E2D\u4E00\u4E2A\u6587\u4EF6\u6216\u6587\u4EF6\u5939\uFF01");return}oe.prompt(`\u5C06 <b>${u.name}</b> \u4FEE\u6539\u4E3A\uFF1A`,"\u63D0\u793A",{dangerouslyUseHTMLString:!0,confirmButtonText:"\u786E\u5B9A",cancelButtonText:"\u53D6\u6D88",inputValue:u.name,inputValidator(g){return!!g},inputErrorMessage:"\u6A21\u677F\u540D\u79F0\u4E0D\u80FD\u4E3A\u7A7A."}).then(({value:g})=>{let d={storageKey:pt.value,path:u.path,name:u.name,newName:g},v;u.type==="FILE"?v=wa:u.type==="FOLDER"&&(v=Sa);const f=bt.service({fullscreen:!0,text:"\u91CD\u547D\u540D\u4E2D...",background:"rgba(255, 255, 255, 0.6)"});v(d).then(()=>{W.success("\u91CD\u547D\u540D\u6210\u529F")}).finally(()=>{f.close(),t()})})},newFolder:()=>{oe.prompt(`\u5728 <b>${rn.value}</b> \u4E0B\u521B\u5EFA\u6587\u4EF6\u5939\uFF0C\u8BF7\u8F93\u5165\u8981\u521B\u5EFA\u7684\u6587\u4EF6\u5939\u540D\u79F0`,"\u63D0\u793A",{dangerouslyUseHTMLString:!0,confirmButtonText:"\u786E\u5B9A",cancelButtonText:"\u53D6\u6D88",draggable:!0,inputValidator(u){return u?u.includes("/")?"\u6587\u4EF6\u5939\u540D\u79F0\u4E0D\u80FD\u5305\u542B /":!0:"\u6587\u4EF6\u5939\u540D\u79F0\u4E0D\u80FD\u4E3A\u7A7A"}}).then(({value:u})=>{let g={storageKey:pt.value,path:rn.value,name:u};ya(g).then(()=>{W.success("\u521B\u5EFA\u6210\u529F")}).finally(()=>{t()})})},moveTo:()=>{W.warning("\u6682\u672A\u5B9E\u73B0")},copyTo:()=>{W.warning("\u6682\u672A\u5B9E\u73B0")},batchDelete:()=>{if(!hr.permission.delete)return;if(H.value.length===0){W.warning("\u8BF7\u5148\u81F3\u5C11\u9009\u4E2D\u4E00\u4E2A\u6587\u4EF6\u6216\u6587\u4EF6\u5939\uFF01");return}let u=H.value.length===1?"\u662F\u5426\u786E\u8BA4\u5220\u9664 ":"\u662F\u5426\u786E\u8BA4\u6279\u91CF\u5220\u9664 ",g=["s3","tencent","aliyun","qiniu","minio","huawei","upyun"];Ue.value.length>0&&(u+=" "+Ue.value.length+" \u4E2A\u6587\u4EF6\u5939"),Ue.value.length>0&&ht.value.length>0&&(u+="\uFF0C"),ht.value.length>0&&(u+=ht.value.length+" \u4E2A\u6587\u4EF6"),Ue.value.length>0&&g.includes(pr.currentStorageSource.type.key)&&(u+=" (\u4E0D\u652F\u6301\u5220\u9664\u975E\u7A7A\u6587\u4EF6\u5939)"),u+="?",oe.confirm(u,"\u63D0\u793A",{confirmButtonText:"\u786E\u5B9A",cancelButtonText:"\u53D6\u6D88",draggable:!0,callback:d=>{if(d==="confirm"){let v={storageKey:pt.value,deleteItems:[]};H.value.forEach(h=>{v.deleteItems.push({path:h.path,name:h.name,type:h.type,password:mr(h.path)})});const f=bt.service({text:"\u5220\u9664\u4E2D...",background:"rgba(0, 0, 0, .3)"});ba(v).then(h=>{W.success(h.msg),t()}).finally(()=>{f.close()})}}})}}}Tt();let yr=De(),le=me();const br=Lt("Meta"),wr=Lt("Control"),Sr=Lt("Shift");let Cr=I(()=>br.value||wr.value),{batchDelete:on}=Pn();const{skeletonLoading:sn,openRow:vt}=Tn(),{selectRows:We,selectRow:un,clearSelection:kt,toggleRowSelection:Ve,toggleAllSelection:xr}=Qe();window.addEventListener("keydown",function(t){var e;t.key==="Escape"&&Ne()?kt():t.key==="a"&&(t.metaKey||t.ctrlKey)&&Ne()?(t.preventDefault(),xr()):t.key==="Delete"&&Ne()?on&&((e=We==null?void 0:We.value)==null?void 0:e.length)>0&&(t.preventDefault(),on()):t.key==="Backspace"&&Ne()&&le.fileList.length>0&&le.fileList[0].type==="BACK"&&At(le.fileList[0])},!1);const Ne=()=>kr()&&En()===!1,kr=()=>document.querySelector(".zfile-index-body:hover"),En=()=>!!document.querySelector(".el-popup-parent--hidden"),Ar=()=>document.querySelector(".is-message-box .el-input__inner")===document.activeElement,Te=F(-1),Pe=F(-1),{pressed:Lr}=Mn();Fe(()=>Lr.value,(t,e)=>{t===!1&&e===!0&&(Te.value=-1,Pe.value=-1)});let At;function jr(){return At=(a,r)=>{var o;if(r===void 0){vt(a);return}let s=r.type==="selection";if(!s&&yr.globalConfig.fileClickMode==="click"){vt(a);return}if(sn.value)return;let l=We.value.length===1&&((o=un.value)==null?void 0:o.name)===a.name;if(Sr.value){let i=le.fileList.findIndex(u=>u.name===un.value.name);if(i!==null){let u=le.fileList.findIndex(v=>v.name===a.name),g=Math.min(u,i),d=Math.max(u,i);for(let v=g+1;v<d;v++){let f=le.fileList[v];Ve(f,!0)}}}else!Cr.value&&!l&&!s&&kt();Ve(a)},{tableClickRow:At,tableDbClickRow:a=>{sn.value||vt(a)},tableHoverRow:(a,r,s,l)=>{if(l.buttons===1&&Te.value!==-1){if(Pe.value===-1){kt();let d=le.fileList[Te.value];Ve(d,!0)}let o=a.index,i=Pe.value>=0?Pe.value:o-1,u=Math.min(i,o),g=Math.max(i,o);for(let d=u;d<=g;d++){let v=le.fileList[d];Ve(v,!0)}Pe.value=o}},tableLeaveRow:(a,r,s,l)=>{l.buttons===1&&Te.value===-1&&(Te.value=a.index)}}}let Ke=me(),ke=De(),Ae=F(!1),cn=!1;const se=F(!1),mt=F(""),U=ve([]),ue=ve([]),te=new Map,ce=new Map;let Tr=0;const dn={error:1,uploading:2,waiting:3,finished:4};function Ur(){let{storageKey:t,currentPath:e}=Me();const n=ke.globalConfig.maxFileUploads,a=c=>{c=document.querySelector("body");const m=b=>{var $,B,O,Mt;let L=((B=($=b.dataTransfer)==null?void 0:$.files)==null?void 0:B.length)>0;if(k(),Ae.value=!1,En()&&L||Ar()||!t.value||!ke.permission.upload)return;b.stopPropagation(),b.preventDefault();const T=bt.service({text:"\u6587\u4EF6\u8BFB\u53D6\u4E2D...",background:"rgba(0, 0, 0, .3)"}),z=((O=b.clipboardData)==null?void 0:O.items)||((Mt=b.dataTransfer)==null?void 0:Mt.items);y(z).then(ze=>{if(qe(()=>{T.close()}),ze.length===0)return;const Dt=()=>{se.value=!0,ze.forEach(Je=>{l({file:Je,uploadToPath:e.value})})};ze.length>100?oe.confirm(`\u6587\u4EF6\u6570\u91CF\u4E3A ${ze.length} \u4E2A\uFF0C\u662F\u5426\u786E\u8BA4\u4E0A\u4F20\uFF1F`,"\u63D0\u793A",{confirmButtonText:"\u786E\u5B9A",cancelButtonText:"\u53D6\u6D88",type:"success",callback:Je=>{Je==="confirm"&&Dt()}}):Dt()})};let p=null;c.addEventListener("dragenter",b=>{!t.value||se.value||!ke.permission.upload||(p=b.target,C(),b.stopPropagation(),b.preventDefault(),Ae.value=!0)},!1),c.addEventListener("dragover",function(b){!t.value||se.value||!ke.permission.upload||(b.stopPropagation(),b.preventDefault(),Ae.value=!0)},!1),c.addEventListener("dragleave",function(b){!t.value||se.value||!ke.permission.upload||(p===b.target&&(k(),Ae.value=!1),b.stopPropagation(),b.preventDefault())},!1),c.addEventListener("drop",m,!1),c.addEventListener("paste",m,!1);const y=b=>et(this,null,function*(){let L=[],T=[];if(b){let z=new Array(...b);for(let $=0;$<z.length;$++){let B=z[$],O=null;if(B.webkitGetAsEntry){if(O=B.webkitGetAsEntry(),!O&&(O=B.getAsFile(),O)){L.push(O);continue}}else if(B.getAsEntry)O=B.getAsEntry();else{W.warning("\u6D4F\u89C8\u5668\u4E0D\u652F\u6301\u62D6\u62FD\u4E0A\u4F20");return}T.push(O)}if(T.length>0)for(let $=0;$<T.length;$++){let B=T[$];if(B){let O=yield Y(B);Array.isArray(O)?A(O,L):L.push(O)}}}return L}),C=()=>{c.classList.add("dragging-over")},k=()=>{c.classList.remove("dragging-over")};function R(b){return new Promise((L,T)=>{b.file(z=>{L(z)})})}function E(b){return new Promise((L,T)=>{b.readEntries(z=>{L(z)})})}function A(b,L){for(let T=0;T<b.length;T++)Array.isArray(b[T])?A(b[T],L):L.push(b[T])}function Y(b){return et(this,null,function*(){let L=b.fullPath||"",T=[];if(b.isFile){let z=yield R(b);return z.dropUploadPath=L,z}else if(b.isDirectory){let z=b.createReader(),$=yield E(z);for(let B=0;B<$.length;B++){let O=yield Y($[B]);T.push(O)}return T}})}},r=()=>{se.value=!0,mt.value="file"},s=()=>{se.value=!0,mt.value="folder",qe(()=>{document.getElementsByClassName("el-upload__input")[0].webkitdirectory=!0})},l=c=>{o(c.file,c.uploadToPath)},o=(c,m)=>{const p=Tr++;if(m=m||e.value,c.webkitRelativePath||c.dropUploadPath){let k=c.webkitRelativePath||c.dropUploadPath;k.startsWith("/")||(k="/"+k);let R=k.split("/");R.forEach((E,A)=>{let Y=A===0,b=R.length-1===A;Y||b||E&&(m+="/"+E)})}let y={storageKey:t.value,path:V.removeDuplicateSeparator(m),name:c.name,size:c.size};if(console.log("\u5F53\u524D\u4E0A\u4F20\u4FE1\u606F:",y,", \u5F53\u524D\u540C\u65F6\u4E0A\u4F20\u6587\u4EF6\u6570:",M.value.totalUploading,"\u9650\u5236\u540C\u65F6\u4E0A\u4F20\u6587\u4EF6\u6570:",n),M.value.totalUploading>=n){console.log(`\u4E0A\u4F20\u6587\u4EF6\u6570\u8D85\u51FA ${n}, \u7B49\u5F85\u4E0A\u4F20`),ue.push({index:p,file:c,uploadToPath:m});return}let C={name:c.name,size:c.size,speed:"-",progress:0,loaded:0,status:"uploading",startTime:Date.now(),file:c,index:p};U.push(C),te.set(p,de.CancelToken.source()),ce.set(p,U[U.length-1]),Ca(y).then(k=>{const{on:R}=zt(`cancel-upload-${p}`);R(()=>{let b=te.get(p);b&&(b.cancel(),U.find((L,T)=>{let z=L.name===c.name;return z&&U.splice(T,1),z}))});let E=V.storageType.proxyType,A=V.storageType.s3Type,Y=V.storageType.micrsoftType;E.includes(Ke.currentStorageSource.type.key)?i(c,k.data,p):A.includes(Ke.currentStorageSource.type.key)?u(c,k.data,p):Y.includes(Ke.currentStorageSource.type.key)?g(c,k.data,p):Ke.currentStorageSource.type.key==="upyun"&&d(c,k.data,p)}).catch(k=>{v(p,k)})},i=(c,m,p)=>{let y=new FormData;y.append("file",c),de.post(m,y,{cancelToken:te.get(p).token,onUploadProgress:C=>{h(C,p,!0)}}).then(()=>{f(p)}).catch(C=>{v(p,C)})},u=(c,m,p)=>{de.put(m,c,{withCredentials:!1,cancelToken:te.get(p).token,onUploadProgress:y=>{h(y,p)}}).then(()=>{f(p)}).catch(y=>{v(p,y)})},g=(c,m,p)=>{let y=1,C=0,k=0,R=c.size;const E=104857599;if(R===0){v(p,"\u5F53\u524D\u5B58\u50A8\u7C7B\u578B\u4E0D\u652F\u6301\u4E0A\u4F20\u7A7A\u6587\u4EF6");return}const A=()=>{C+E>=R?k=R:k=C+E,y>1&&te.set(p,de.CancelToken.source());let Y=c.slice(C,k);de.put(`${m}`,Y,{cancelToken:te.get(p).token,timeout:1e7,headers:{"Content-Type":"application/octet-stream","Content-Range":`bytes ${C}-${k-1}/${c.size}`},type:"sync",withCredentials:!1,onUploadProgress:b=>{if(b.lengthComputable){let L=ce.get(p);const T=b.loaded+C;L.size=R,L.loaded=T,L.progress=Math.round(T/R*100),L.speed=V.fileSizeFormat(Math.round(T/(Date.now()-L.startTime)*1e3))}}}).then(b=>{b.status===202?(C+=E,y+=1,A()):(b.status===201||b.status===200)&&f(p)}).catch(b=>{v(p,b)})};A()},d=(c,m,p)=>{let y=JSON.parse(m),C=new FormData;C.append("name",c.name),C.append("authorization",y.signature),C.append("policy",y.policy),C.append("file",c),de.post(y.url,C,{withCredentials:!1,cancelToken:te.get(p).token,onUploadProgress:k=>{h(k,p)}}).then(()=>{f(p)}).catch(k=>{v(p,k)})},v=(c,m)=>{var y;let p=ce.get(c);p.status="error",p.endTime=Date.now(),p.msg=((y=m==null?void 0:m.response)==null?void 0:y.data)||m},f=c=>{let m=ce.get(c);m.progress=100,m.status="finished",m.endTime=Date.now(),m.msg="\u4E0A\u4F20\u6210\u529F"},h=(c,m,p)=>{let y=ce.get(m);y.size=c.total,y.loaded=c.loaded,y.progress=Math.round(c.loaded/c.total*100),y.speed=V.fileSizeFormat(Math.round(c.loaded/(Date.now()-y.startTime)*1e3)),console.log("uploadFileInfo",y,p),p&&y.progress===100&&(y.msg="\u4E0A\u4F20\u5B8C\u6210, \u670D\u52A1\u5668\u4E2D\u8F6C\u4E2D...")},x=c=>{oe.confirm(`\u662F\u5426\u786E\u5B9A\u53D6\u6D88\u6587\u4EF6 ${c.name} \u4E0A\u4F20\uFF1F`,"\u63D0\u793A",{confirmButtonText:"\u786E\u5B9A",cancelButtonText:"\u8FD4\u56DE",type:"warning",callback:m=>{m==="confirm"&&zt(`cancel-upload-${c.index}`).emit()}})},M=I(()=>{let c=U.length,m=0,p=0;U.forEach(C=>{C.status==="uploading"?m++:C.status==="finished"&&p++});let y=m+ue.length;return{totalSize:c,totalUploading:m,totalFinish:p,totalUploadingAndWaiting:y}}),P=I(()=>{let c=[];return c.push(...U),ue.forEach(m=>{c.push({name:m.file.name,size:m.file.size,status:"waiting",msg:"\u6392\u961F\u4E2D...",index:m.index})}),c.sort((m,p)=>{let y=m.status,C=p.status;return y!==C?dn[y]-dn[C]:m.startTime!==p.startTime?m.startTime-p.startTime:m.endTime-p.endTime}),console.log("uploadProgressInfoSorted",c),c});cn||(Fe(()=>M.value.totalUploading,c=>{if(c<n)if(console.log("\u68C0\u6D4B\u5230\u4E0A\u4F20\u4E2D\u7684\u6587\u4EF6\u4E2A\u6570\u5C0F\u4E8E\u6700\u5927\u4E0A\u4F20\u9650\u5236."),ue.length===0)console.log("\u7B49\u5F85\u4E0A\u4F20\u7684\u6587\u4EF6\u6570\u4E3A 0, \u65E0\u9700\u7EE7\u7EED\u4E0A\u4F20.");else{let p=ue.splice(0,1)[0];l({file:p.file,uploadToPath:p.uploadToPath}),console.log("\u5F00\u59CB\u4ECE\u7B49\u5F85\u961F\u5217\u4E2D\u83B7\u53D6\u4E0A\u4F20\u6587\u4EF6: ",p.file.name)}}),cn=!0);const D=c=>{if(c==null)return;let m=U.findIndex((p,y)=>{if(p.index===c)return U.splice(y,1),!0});m===-1&&(m=ue.findIndex((p,y)=>{if(p.index===c)return ue.splice(y,1),!0})),m!==-1&&(ce.delete(c),te.delete(c))};return{visible:se,uploadMode:mt,openUploadDialog:r,openUploadFolderDialog:s,cancelUpload:x,dropState:Ae,listenDropFile:a,beforeUpload:l,uploadFile:o,uploadProgressInfoSorted:P,uploadProgressInfoStatistics:M,clearALlFinishedUploadFile:()=>{let c=0;for(let m=U.length-1;m>=0;m--){let p=U[m];p.status==="finished"&&(c++,U.splice(m,1),ce.delete(p.index),te.delete(p.index))}return c},removeUploadFileByIndex:D,retryUpload:c=>{console.log("\u91CD\u65B0\u4E0A\u4F20\u6587\u4EF6",c),D(c.index),o(c.file)}}}export{De as a,$r as b,Qe as c,Ur as d,Tn as e,jr as f,Pn as g,tr as h,Yn as i,He as j,_r as k,Ir as l,Et as m,Or as r,me as u};
